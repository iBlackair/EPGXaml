<Window x:Class="EPGVirtualization.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:EPGVirtualization"
        xmlns:epg="clr-namespace:EPGVirtualization.Controls;assembly=EPGVirtualization"
        xmlns:converters="clr-namespace:EPGVirtualization.Converters"
        mc:Ignorable="d"
        Title="EPG Viewer" Height="720" Width="1280"
        Background="#FF121212">

    <Window.Resources>
        <!-- Styles for buttons -->
        <Style x:Key="NavButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#FF303030"/>
            <Setter Property="Foreground" Value="#FFEEEEEE"/>
            <Setter Property="BorderBrush" Value="#FF505050"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="12,0"/>
        </Style>

        <!-- Styles for program details -->
        <Style x:Key="ProgramTitleStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFEEEEEE"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <Style x:Key="ProgramDetailStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFBBBBBB"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>

        <!-- Converters -->
        <converters:DateToFormattedStringConverter x:Key="DateToFormattedStringConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Navigation Toolbar -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Background="#FF202020">
            <Button Content="Today" Style="{StaticResource NavButtonStyle}" Click="TodayButton_Click"/>
            <Button Content="Previous Day" Style="{StaticResource NavButtonStyle}" Click="PreviousDayButton_Click"/>
            <Button Content="Next Day" Style="{StaticResource NavButtonStyle}" Click="NextDayButton_Click"/>
            <Button Content="Now" Style="{StaticResource NavButtonStyle}" Click="NowButton_Click"/>
            <Separator Margin="8,0" Background="#FF505050" Width="1"/>
            <TextBlock Text="{Binding ElementName=EPG, Path=ViewStartTime, Converter={StaticResource DateToFormattedStringConverter}, ConverterParameter='dddd, MMMM d, yyyy'}" 
                       VerticalAlignment="Center" Foreground="#FFEEEEEE" FontWeight="SemiBold"/>
            <Separator Margin="8,0" Background="#FF505050" Width="1"/>
            <Slider x:Name="ZoomSlider" Width="150" VerticalAlignment="Center" Minimum="0.5" Maximum="3.0" 
                    Value="{Binding ElementName=EPG, Path=Zoom}" TickFrequency="0.5" TickPlacement="BottomRight"/>
        </StackPanel>

        <!-- EPG Control -->
        <epg:EPGControl x:Name="EPG" Grid.Row="1" 
                        ViewStartTime="{Binding CurrentDate}" 
                        Programs="{Binding ProgramList}"
                        SelectedProgram="{Binding SelectedProgram, Mode=TwoWay}"
                        Zoom="1.0"
                        PixelsPerMinute="3"
                        ChannelHeight="40"
                        TimelineHeight="40"
                        ChannelLabelWidth="120"
                        EvenRowBackground="#FF191919"
                        OddRowBackground="#FF131314"
                        TimelineBrush="#FF070709"
                        ChannelLabelBrush="#FF070709"
                        ProgramSelected="EPG_ProgramSelected"
                        ProgramAction="EPG_ProgramAction"
                        ViewChanged="EPG_ViewChanged"/>

        <!-- Program Details Panel -->
        <Border Grid.Row="2" Background="#FF202020" BorderBrush="#FF303030" BorderThickness="0,1,0,0" Padding="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Program Details -->
                <StackPanel Grid.Column="0">
                    <TextBlock x:Name="ProgramTitle" 
                               Text="{Binding SelectedProgram.Title, FallbackValue='No program selected'}" 
                               Style="{StaticResource ProgramTitleStyle}"/>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="{Binding SelectedProgram.StartTime, StringFormat=\{0:HH:mm\}, FallbackValue=''}" 
                                   Foreground="#FFBBBBBB"/>
                        <TextBlock Text=" - " Foreground="#FFBBBBBB" 
                                   Visibility="{Binding SelectedProgram, Converter={StaticResource NullToVisibilityConverter}}"/>
                        <TextBlock Text="{Binding SelectedProgramEndTime, StringFormat=\{0:HH:mm\}, FallbackValue=''}" 
                                   Foreground="#FFBBBBBB"/>
                        <TextBlock Text=" | " Foreground="#FFBBBBBB" Margin="8,0" 
                                   Visibility="{Binding SelectedProgram, Converter={StaticResource NullToVisibilityConverter}}"/>
                        <TextBlock Text="{Binding SelectedProgram.Category, FallbackValue=''}" 
                                   Foreground="#FF88AAFF"/>
                    </StackPanel>

                    <TextBlock Text="{Binding SelectedProgram.Description, FallbackValue='Select a program to view details'}" 
                               Style="{StaticResource ProgramDetailStyle}"/>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Bottom">
                    <Button Content="Watch" Style="{StaticResource NavButtonStyle}" Click="WatchButton_Click"
                            IsEnabled="{Binding SelectedProgram, Converter={StaticResource NullToBoolConverter}}"/>
                    <Button Content="Record" Style="{StaticResource NavButtonStyle}" Click="RecordButton_Click"
                            IsEnabled="{Binding SelectedProgram, Converter={StaticResource NullToBoolConverter}}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>